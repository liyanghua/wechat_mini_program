<!-- pages/customize/customize.wxml -->
<view class="container">
  <!-- 预览区域 -->
  <view class="preview-container">
    <!-- 隐藏的canvas用于图片处理 -->
    <canvas
      canvas-id="customCanvas"
      style="width:{{canvasWidth}}px; height:{{canvasHeight}}px;"
      class="hidden-canvas">
    </canvas>
    
    <!-- 预览图片 -->
    <view class="preview-section">
      <image 
        wx:if="{{previewImage}}"
        src="{{previewImage}}"
        mode="aspectFit"
        class="preview-image"
        bindtap="previewImage"
      />
      <image 
        wx:else
        src="{{product.originalImage}}"
        mode="aspectFit"
        class="preview-image"
      />
    </view>
  </view>

  <!-- 操作区域 -->
  <view class="action-section">
    <view class="product-info">
      <text class="product-name">{{product.name}}</text>
      <text class="product-price">¥{{product.price}}</text>
    </view>

    <view class="upload-section">
      <button 
        class="upload-btn {{imageLoading ? 'loading' : ''}}" 
        bindtap="chooseImage"
        disabled="{{imageLoading}}"
      >
        {{imageLoading ? '处理中...' : '上传定制图片'}}
      </button>
      <text class="upload-tip">建议使用清晰的方形图片，避免图片被拉伸</text>
    </view>

    <block wx:if="{{customImage}}">
      <button 
        class="confirm-btn" 
        bindtap="confirmDesign"
      >
        确认定制
      </button>
    </block>
  </view>
</view>